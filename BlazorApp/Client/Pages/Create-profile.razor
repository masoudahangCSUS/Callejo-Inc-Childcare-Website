@page "/create-profile"
@inject IJSRuntime JS
@inject HttpClient Http
@inject NavigationManager Navigation
@rendermode InteractiveServer

@using BlazorApp.Server.Data
@using BlazorApp.Server.Models
@using Microsoft.AspNetCore.Components.Forms

<h3>Create Profile</h3>

<EditForm Model="@newUser" OnSubmit="SaveProfile" FormName="CreateProfileForm">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label>First Name:</label>
        <InputText @bind-Value="newUser.FirstName" class="form-control" />
    </div>

    <div>
        <label>Middle Name:</label>
        <InputText @bind-Value="newUser.MiddleName" class="form-control" />
    </div>

    <div>
        <label>Last Name:</label>
        <InputText @bind-Value="newUser.LastName" class="form-control" />
    </div>

    <div>
        <label>Address:</label>
        <InputText @bind-Value="newUser.Address" class="form-control" />
    </div>

    <div>
        <label>City:</label>
        <InputText @bind-Value="newUser.City" class="form-control" />
    </div>

    <div>
        <label>State:</label>
        <InputText @bind-Value="newUser.State" class="form-control" />
    </div>

    <div>
        <label>Zip Code:</label>
        <InputText @bind-Value="newUser.ZipCode" class="form-control" />
    </div>
    <br/>

    <button type="submit" class="btn btn-primary">Save Profile</button>
</EditForm>


@code {
    private CallejoIncUser newUser = new CallejoIncUser();
    private bool saveSuccess;

    private async Task SaveProfile()
    {
        try
        {
            newUser.FkRole = 1;
            // DbContext.CallejoIncUsers.Add(newUser);
            // await DbContext.SaveChangesAsync();

            var apiUrl = $"{Navigation.BaseUri}api/users/create-user";
            var response = await Http.PostAsJsonAsync(apiUrl, newUser);

            if (response.IsSuccessStatusCode)
            {
                saveSuccess = true;
                newUser = new CallejoIncUser();
            }
            else{
                saveSuccess = false;
                Console.WriteLine($"Error saving profile: {response.ReasonPhrase}");
                Console.WriteLine(response);
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error saving profile: {ex.Message}");
            saveSuccess = false;
        }
    }
}